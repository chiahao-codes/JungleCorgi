<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('./partials/head.ejs') %>
</head>

<body id="ticker_body" class="body">
    <header class="headerBox">
        <h2 contenteditable></h2>
    </header>

    <section id="stock_price_container">
        <div id="home-chart-container">
            <div id="home-price-container">
                <div id="home_link_container">
                    <a href="<%=CURR_DOMAIN%>" target="_self">Home</a>
                    <span id="arrow">></span>
                    <span id="symbol">
                        <% let symb="" %>
                            <% if(getSumm){ %>
                                <% if(getSumm.symbol){%>
                                    <% symb=getSumm.symbol%>
                                        <% }}%>
                                            <%=symb%>
                    </span>
                </div>
                <div id="price_hours_container">
                    <h5 id="company_name">
                        <% let name="" %>
                            <% if(getSumm){%>
                                <% if(getSumm.quoteType.shortName){ %>
                                    <% name=getSumm.quoteType.shortName %>
                                        <% if(getSumm.quoteType.longName){ %>
                                            <% name=getSumm.quoteType.longName %>
                                                <% }}} %>
                                                    <%= name %>
                    </h5>
                    <div id="price_time_container">
                        <div id="reg_container" class="reg_after_container">
                            <div id="reg_hours_container" class="reg_hours_container">
                                <h3 id="reg_hours_price" class="price">

                                </h3>
                                <div id="reg_hours_pct_container" class="hours_pct_container">
                                    <h5 id="reg_hours_change" class="price">

                                    </h5>
                                    <h5 id="reg_hours_pct" class="price">

                                    </h5>
                                </div>
                            </div>
                            <div id="at_close_container" class="trading_hours_container">
                                <h6 id="at_close_txt"></h6>
                                <h6 id="at_close_time"></h6>
                            </div>
                        </div>
                        <div id="after_container" class="reg_after_container">
                            <div id="after_hours_pp_container" class="reg_hours_container">
                                <h5 id="after_hours_price" class="price">

                                </h5>
                                <div id="after_hours_pct_container" class="hours_pct_container">
                                    <h6 id="after_hours_change" class="price">

                                    </h6>
                                    <h6 id="after_hours_pct" class="price">
                                    </h6>
                                </div>
                            </div>
                            <div id="after_hours_time_container" class="trading_hours_container">
                                <h6 id="after_hours_txt"></h6>
                                <h6 id="after_hours_time"></h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="chart_container">
                <div id="progress-bar-container">
                    <div id="progress-bar" style="--width:35">Loading...</div>
                </div>
                <canvas id="chart" class="charts"></canvas>
            </div>
        </div>
        <div id="chart-timeline-container">
            <h6 id="1d" class="timeline-link ">1D</h6>
            <h6 id="5d" class="timeline-link ">5D</h6>
            <h6 id="1mo" class="timeline-link">1M</h6>
            <h6 id="YTD" class="timeline-link">YTD</h6>
            <h6 id="2y" class="timeline-link">2Y</h6>
        </div>
        </div>
        <section id="index_data_container" class="index_data_container">
            <div id="ratio-container" class="index-data-kids">
                <div class="border-line">
                    <div id="fwdPeRatio">Forward P/E</div>
                    <% let fwdPeRatio="N/A" %>
                        <% if(getSumm.defaultKeyStatistics){ %>
                            <% if(getSumm.defaultKeyStatistics.forwardPE){ %>
                                <% fwdPeRatio=getSumm.defaultKeyStatistics.forwardPE.fmt}} %>
                                    <div id="fwdPeRatioData" class="indexData">
                                        <%=fwdPeRatio %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="ttmPeRatio">P/E (TTM)</div>
                    <% let ttmPeRatio="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.trailingPE){ %>
                                <% ttmPeRatio=getSumm.summaryDetail.trailingPE.fmt}} %>
                                    <div id="ttmPeRatioData" class="indexData">
                                        <%=ttmPeRatio %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="eps">EPS (TTM)</div>
                    <% let eps="N/A" %>
                        <% if(getSumm.defaultKeyStatistics){ %>
                            <% if(getSumm.defaultKeyStatistics.trailingEps){ %>
                                <% eps=getSumm.defaultKeyStatistics.trailingEps.fmt}} %>
                                    <div id="epsData" class="indexData">
                                        <%=eps%>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="peg-ratio">Peg Ratio</div>
                    <% let pegRatio="N/A" %>
                        <% if(getSumm.defaultKeyStatistics){ %>
                            <% if(getSumm.defaultKeyStatistics.pegRatio){ %>
                                <% pegRatio=getSumm.defaultKeyStatistics.pegRatio.fmt}} %>
                                    <div id="pegRatio" class="indexData">
                                        <%=pegRatio%>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="curr-ratio">Current Ratio</div>
                    <% let currRatio="N/A" %>
                        <% if(getSumm.financialData){ %>
                            <% if(getSumm.financialData.currentRatio){ %>
                                <% currRatio=getSumm.financialData.currentRatio.fmt}} %>
                                    <div id="curr-ratio" class="indexData">
                                        <%=currRatio%>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="quick-ratio">Quick Ratio</div>
                    <% let quickRatio="N/A" %>
                        <% if(getSumm.financialData){ %>
                            <% if(getSumm.financialData.quickRatio){ %>
                                <% quickRatio=getSumm.financialData.quickRatio.fmt}} %>
                                    <div id="quick-ratio" class="indexData">
                                        <%=quickRatio%>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="debt-ratio">Debt-to-Equity Ratio</div>
                    <% let debtRatio="N/A" %>
                        <% if(getSumm.financialData){ %>
                            <% if(getSumm.financialData.debtToEquity){ %>
                                <% debtRatio=getSumm.financialData.debtToEquity.fmt}}%>
                                    <div id="debt-ratio" class="indexData">
                                        <%=debtRatio%>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="pb-ratio">Price-to-Book Ratio</div>
                    <% let pb="N/A" %>
                        <% if(getSumm.defaultKeyStatistics){ %>
                            <% if(getSumm.defaultKeyStatistics.priceToBook){ %>
                                <% pb=getSumm.defaultKeyStatistics.priceToBook.fmt}} %>
                                    <div id="pb-ratio" class="indexData">
                                        <%=pb%>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="op-Margin">Operating Margin</div>
                    <% let opMargin="N/A" %>
                        <% if(getSumm.financialData){ %>
                            <% if(getSumm.financialData.operatingMargins){ %>
                                <% opMargin=getSumm.financialData.operatingMargins.fmt}} %>
                                    <div id="op-Margin" class="indexData">
                                        <%=opMargin%>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="prof-Margin">Profit Margin</div>
                    <% let profMargin="N/A" %>
                        <% if(getSumm.financialData){ %>
                            <% if(getSumm.financialData.profitMargins){ %>
                                <% profMargin=getSumm.financialData.profitMargins.fmt}} %>
                                    <div id="prof-Margin" class="indexData">
                                        <%=profMargin%>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="grossMargin">Gross Margin</div>
                    <% let grossMargin="N/A" %>
                        <% if(getSumm.financialData){ %>
                            <% if(getSumm.financialData.grossMargins){ %>
                                <% grossMargin=getSumm.financialData.grossMargins.fmt}} %>
                                    <div id="grossMarginPct" class="indexData">
                                        <%=grossMargin %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="dividend">Forward Dividend</div>
                    <div id="dividendRate" class="indexData div-rate">
                    </div>
                </div>
                <div class="border-line no-border-bottom">
                    <div id="exDividend">Ex-Dividend Date</div>
                    <div id="exDivDate" class="indexData exDivDate">
                    </div>
                </div>
            </div>
            <div id="prev-close-container" class="index-data-kids">
                <div class="border-line">
                    <div id="prevClose">Previous Close</div>
                    <% let prvClose="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.previousClose){ %>
                                <% prvClose=getSumm.summaryDetail.previousClose.fmt}} %>
                                    <div id="prevClosData" class="indexData">
                                        <%=prvClose %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="open">Market Open</div>
                    <% let open="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.open){ %>
                                <% open=getSumm.summaryDetail.open.fmt}} %>
                                    <div id="openData" class="indexData">
                                        <%=open %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="dayLow">Day's Low</div>
                    <% let dayLow="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.dayLow){ %>
                                <% dayLow=getSumm.summaryDetail.dayLow.fmt}} %>
                                    <div id="dayLowData" class="indexData">
                                        <%=dayLow %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="dayHigh">Day's High</div>
                    <% let dayHigh="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.dayHigh){ %>
                                <% dayHigh=getSumm.summaryDetail.dayHigh.fmt}} %>
                                    <div id="dayHighData" class="indexData">
                                        <%=dayHigh %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="fifty2WkLow">52 Week Low</div>
                    <% let fifty2WkLo="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.fiftyTwoWeekLow){ %>
                                <% fifty2WkLo=getSumm.summaryDetail.fiftyTwoWeekLow.fmt} }%>
                                    <div id="fifty2WkLowData" class="indexData">
                                        <%=fifty2WkLo %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="fifty2WkHigh">52 Week High</div>
                    <% let fifty2WkHi="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.fiftyTwoWeekHigh){ %>
                                <% fifty2WkHi=getSumm.summaryDetail.fiftyTwoWeekHigh.fmt}} %>
                                    <div id="fifty2WkHighData" class="indexData">
                                        <%=fifty2WkHi %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="twoHundDayAvg">200 Day Avg</div>
                    <% let twoHDAvg="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.twoHundredDayAverage){ %>
                                <% twoHDAvg=getSumm.summaryDetail.twoHundredDayAverage.fmt}} %>
                                    <div id="twoHundDayAvgData" class="indexData">
                                        <%=twoHDAvg %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id='bid'>Bid</div>
                    <% let bid="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% bid=getSumm.summaryDetail.bid.fmt} %>
                                <div id='bidData' class="indexData">
                                    <%=bid %>
                                </div>
                </div>
                <div class="border-line">
                    <div id="ask">Ask</div>
                    <%let ask="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% ask=getSumm.summaryDetail.ask.fmt} %>
                                <div id="askData" class="indexData">
                                    <%=ask %>
                                </div>
                </div>
                <div class="border-line">
                    <div id="beta">Beta</div>
                    <%let beta="N/A" %>
                        <% if(getSumm){ %>
                            <% if(getSumm.summaryDetail.beta){ %>
                                <% beta=getSumm.summaryDetail.beta.fmt}} %>
                                    <div id="beta" class="indexData">
                                        <%=beta %>
                                    </div>
                </div>
                <div class="border-line">
                    <div id="mktCap">Market Cap</div>
                    <%let mktCap="N/A" %>
                        <% if(getSumm){ %>
                            <% if(getSumm.defaultKeyStatistics){ %>
                                <% if(getSumm.defaultKeyStatistics.price){ %>
                                    <% mktCap=getSumm.defaultKeyStatistics.price.marketCap.fmt}}}%>
                                        <div id="mktCap" class="indexData commas">
                                            <%=mktCap %>
                                        </div>
                </div>
                <div class="border-line">
                    <div id="volume">Volume</div>
                    <%let volume="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.volume){ %>
                                <% volume=getSumm.summaryDetail.volume.fmt}}%>
                                    <div id="mktVol" class="indexData commas">
                                        <%=volume %>
                                    </div>
                </div>
                <div class="border-line no-border-bottom">
                    <div id="avgVolume">Avg. Volume</div>
                    <%let avgVol="N/A" %>
                        <% if(getSumm.summaryDetail){ %>
                            <% if(getSumm.summaryDetail.averageVolume){ %>
                                <% avgVol=getSumm.summaryDetail.averageVolume.fmt}}%>
                                    <div id="avgVol" class="indexData commas">
                                        <%=avgVol %>
                                    </div>
                </div>
            </div>

        </section>
        <section id="slide-container">
            <!-- If we need navigation buttons -->
            <div id="nav-buttons-container">
                <div class="slide-prev chevrons">
                    <img id='left-chev' src="/icons8-back-20.png" alt="left-chevron">
                </div>
                <div class="slide-next chevrons">
                    <img id="right-chev" src="/icons8-forward-20.png" alt="right-chevron">
                </div>
            </div>
            <!-- Slides -->
            <div class="slides-wrapper">
                <% let arrLastEle %>
                    <% let ccy="--" %>
                        <div id="income-statement" class="slide">
                            <h6>Income Statement</h6>
                            <div class="annual-label">Annual</div>
                            <div class="slide-boxes">
                                <div class="slide-data-wrapper income-slide-years slide-years">
                                    <div class="slide-data slide-headers data-align-left currency">

                                        <% if(incomeResult){%>
                                            <%if(incomeResult.summaryDetail){%>
                                                <%if(incomeResult.summaryDetail.currency){%>
                                                    <%ccy=incomeResult.summaryDetail.currency%>
                                                        <% }}} %>
                                                            (<%=ccy%>)
                                    </div>
                                    <div class="slide-data slide-headers ttm">TTM
                                    </div>
                                    <div class="slide-data slide-headers year1 endingyr1">
                                        <% let annYr={"one":"--", "two" :"--"}%>
                                            <% if(incomeResult){%>
                                                <% if(incomeResult.timeSeries){%>
                                                    <% if(incomeResult.timeSeries.timestamp){ %>
                                                        <% let arrTimeStp=incomeResult.timeSeries.timestamp %>
                                                            <% let arrLastEle=arrTimeStp.length-1 %>
                                                                <% annYr["one"]=arrTimeStp[arrLastEle] %>
                                                                    <% annYr["two"]=arrTimeStp[arrLastEle - 1] %>
                                                                        <% }}} %>
                                                                            <%=annYr["one"] %>
                                    </div>
                                    <div class="slide-data slide-headers year2 endingyr2">
                                        <%=annYr["two"] %>
                                    </div>
                                </div>
                                <div class="slide-data-wrapper total-revenue">
                                    <div class="slide-data data-align-left">
                                        Revenue</div>
                                    <div class="slide-data  ttm">
                                        <%let ttmRev%>
                                            <% let ttmValue="--" %>
                                                <% if(incomeResult){%>
                                                    <% if(incomeResult.timeSeries){ %>
                                                        <% if(incomeResult.timeSeries.trailingTotalRevenue){ %>
                                                            <% ttmRev=incomeResult.timeSeries.trailingTotalRevenue %>
                                                                <% if(ttmRev.length>0){ %>
                                                                    <% arrLastEle=ttmRev.length-1 %>
                                                                        <%
                                                                            ttmValue=ttmRev[arrLastEle].reportedValue.fmt%>
                                                                            <% }%>
                                                                                <% }}} %>
                                                                                    <%=ttmValue %>
                                    </div>
                                    <div class="slide-data year1">

                                    </div>
                                    <div class="slide-data year2">

                                    </div>
                                </div>
                                <div class="slide-data-wrapper gross-profit">
                                    <div class="slide-data data-align-left">Gross profit</div>
                                    <% let ttmGP%>
                                        <% let grossProfitVal="--" %>
                                            <div class="slide-data ttm">
                                                <% if(incomeResult){%>
                                                    <% if(incomeResult.timeSeries){ %>
                                                        <% if(incomeResult.timeSeries.trailingGrossProfit){ %>
                                                            <% ttmGP=incomeResult.timeSeries.trailingGrossProfit %>
                                                                <% if(ttmGP.length>0){ %>
                                                                    <% arrLastEle=ttmGP.length-1 %>
                                                                        <%
                                                                            grossProfitVal=ttmGP[arrLastEle].reportedValue.fmt%>
                                                                            <% }%>
                                                                                <% }}}%>
                                                                                    <%=grossProfitVal%>
                                            </div>
                                            <div class="slide-data year1">

                                            </div>
                                            <div class="slide-data year2">

                                            </div>
                                </div>
                                <div class="slide-data-wrapper operating-expense">
                                    <div class="slide-data data-align-left">Operating expense</div>
                                    <% let ttmOpExp="--" %>
                                        <% let opExpArr %>
                                            <% if(incomeResult){%>
                                                <% if(incomeResult.timeSeries){ %>
                                                    <% if(incomeResult.timeSeries.trailingGrossProfit){ %>
                                                        <% opExpArr=incomeResult.timeSeries.trailingGrossProfit%>
                                                            <% if(opExpArr.length>0){ %>
                                                                <% arrLastEle=opExpArr.length-1%>
                                                                    <% ttmOpExp=opExpArr[arrLastEle].reportedValue.fmt%>
                                                                        <% }%>
                                                                            <% }}} %>
                                                                                <div class="slide-data  ttm">
                                                                                    <%=ttmOpExp %>
                                                                                </div>
                                                                                <div class="slide-data year1">

                                                                                </div>
                                                                                <div class="slide-data year2">

                                                                                </div>
                                </div>
                                <div class="slide-data-wrapper operating-income">
                                    <% let ttmOpInc="--" %>
                                        <% let opIncArr %>
                                            <% if(incomeResult){%>
                                                <% if(incomeResult.timeSeries){ %>
                                                    <% if(incomeResult.timeSeries.trailingOperatingIncome){ %>
                                                        <% opIncArr=incomeResult.timeSeries.trailingOperatingIncome%>
                                                            <% if(opIncArr.length>0){ %>
                                                                <% arrLastEle=opIncArr.length-1%>
                                                                    <% ttmOpInc=opIncArr[arrLastEle].reportedValue.fmt%>
                                                                        <% }%>
                                                                            <% }}} %>

                                                                                <div class="slide-data data-align-left">
                                                                                    Operating income</div>
                                                                                <div class="slide-data  ttm">
                                                                                    <%=ttmOpInc %>
                                                                                </div>
                                                                                <div class="slide-data year1">

                                                                                </div>
                                                                                <div class="slide-data year2">

                                                                                </div>
                                </div>
                                <div class="slide-data-wrapper pre-tax-income">
                                    <div class="slide-data data-align-left">Pre tax income</div>
                                    <% let ttmPreTaxInc="--" %>
                                        <% let preTaxArr %>
                                            <% if(incomeResult){%>
                                                <% if(incomeResult.timeSeries){ %>
                                                    <% if(incomeResult.timeSeries.trailingPretaxIncome){ %>
                                                        <% preTaxArr=incomeResult.timeSeries.trailingPretaxIncome%>
                                                            <% if(preTaxArr.length>0){ %>
                                                                <% arrLastEle=preTaxArr.length-1 %>
                                                                    <%
                                                                        ttmPreTaxInc=preTaxArr[arrLastEle].reportedValue.fmt%>
                                                                        <% }%>
                                                                            <% }}} %>
                                                                                <div class="slide-data  ttm">
                                                                                    <%=ttmPreTaxInc %>
                                                                                </div>
                                                                                <div class="slide-data year1">
                                                                                </div>
                                                                                <div class="slide-data year2">
                                                                                </div>
                                </div>
                                <div class="slide-data-wrapper other-income-expense">
                                    <div class="slide-data data-align-left">Other income exp</div>
                                    <% let ttmOthIncExp="--" %>
                                        <% let otInArr %>
                                            <% if(incomeResult){%>
                                                <% if(incomeResult.timeSeries){ %>
                                                    <% if(incomeResult.timeSeries.trailingOtherIncomeExpense){ %>
                                                        <% otInArr=incomeResult.timeSeries.trailingOtherIncomeExpense%>
                                                            <% if(otInArr.length>0){ %>
                                                                <% arrLastEle=otInArr.length-1 %>
                                                                    <%
                                                                        ttmOthIncExp=otInArr[arrLastEle].reportedValue.fmt%>
                                                                        <% }%>
                                                                            <% }}} %>
                                                                                <div class="slide-data ttm">
                                                                                    <%=ttmOthIncExp %>
                                                                                </div>
                                                                                <div class="slide-data year1">

                                                                                </div>
                                                                                <div class="slide-data year2">

                                                                                </div>
                                </div>

                                <div class="slide-data-wrapper basic-eps">
                                    <div class="slide-data data-align-left">Basic eps</div>
                                    <% let ttmBasicEps="--" %>
                                        <% let basicEpArr %>
                                            <% if(incomeResult){%>
                                                <% if(incomeResult.timeSeries){ %>
                                                    <% if(incomeResult.timeSeries.trailingBasicEPS){ %>
                                                        <% basicEpArr=incomeResult.timeSeries.trailingBasicEPS%>
                                                            <% if(opExpArr.length>0){ %>
                                                                <% arrLastEle=opExpArr.length-1%>
                                                                    <%
                                                                        ttmBasicEps=basicEpArr[arrLastEle].reportedValue.fmt%>
                                                                        <% }%>
                                                                            <% }}} %>
                                                                                <div class="slide-data  ttm">
                                                                                    <%=ttmBasicEps %>
                                                                                </div>
                                                                                <div class="slide-data year1">

                                                                                </div>
                                                                                <div class="slide-data year2">

                                                                                </div>
                                </div>
                                <div class="slide-data-wrapper net-income">
                                    <div class="slide-data data-align-left">Net income</div>
                                    <% let netIncArr %>
                                        <% let ttmNetInc="--" %>
                                            <% if(incomeResult){%>
                                                <% if(incomeResult.timeSeries){ %>
                                                    <% if(incomeResult.timeSeries.trailingNetIncome){ %>
                                                        <% netIncArr=incomeResult.timeSeries.trailingNetIncome%>
                                                            <% if(netIncArr.length>0){ %>
                                                                <% arrLastEle=netIncArr.length-1%>
                                                                    <%
                                                                        ttmNetInc=netIncArr[arrLastEle].reportedValue.fmt%>
                                                                        <% }%>
                                                                            <% }}} %>
                                                                                <div class="slide-data  ttmNetIncome">
                                                                                    <%=ttmNetInc%>
                                                                                </div>
                                                                                <div class="slide-data year1">

                                                                                </div>
                                                                                <div class="slide-data year2">

                                                                                </div>
                                </div>

                            </div>
                        </div>
                        <div id="balance-sheet" class="slide">
                            <h6>Balance Sheet</h6>
                            <div class="annual-label">Annual</div>
                            <div class="slide-boxes">
                                <div class="slide-data-wrapper balance-slide-years slide-years">
                                    <% let balanceYear={"zero":"--","one":"--", "two" :"--"}%>
                                        <% if(balanceResult){%>
                                            <%if(balanceResult.summaryDetail){%>
                                                <%if(balanceResult.summaryDetail.currency){%>
                                                    <%ccy=balanceResult.summaryDetail.currency%>
                                                        <% }%>
                                                            <% if(balanceResult.timeSeries.timestamp){ %>
                                                                <% let balanceTimestamp%>
                                                                    <%balanceTimestamp=balanceResult.timeSeries.timestamp%>
                                                                        <%balanceYear["zero"]=balanceTimestamp[0]%>
                                                                            <%balanceYear["one"]=balanceTimestamp[1]%>
                                                                                <%balanceYear["two"]=balanceTimestamp[2]%>
                                                                                    <% }}} %>
                                                                                        <div
                                                                                            class="slide-data slide-headers data-align-left currency">
                                                                                            (<%=ccy%>)
                                                                                        </div>

                                                                                        <div
                                                                                            class="slide-data slide-headers year1 endingyr1">
                                                                                            <%=balanceYear["two"] %>
                                                                                        </div>
                                                                                        <div
                                                                                            class="slide-data slide-headers year2 endingyr2">
                                                                                            <%=balanceYear["one"] %>
                                                                                        </div>
                                                                                        <div
                                                                                            class="slide-data slide-headers year3 endingyr3">
                                                                                            <%=balanceYear["zero"] %>
                                                                                        </div>
                                </div>
                                <div class="slide-data-wrapper total-assets">
                                    <div class="slide-data data-align-left">Total assets</div>
                                    <% let totalAssets={0:"--", 1:"--", 2:"--"} %>
                                        <% if(balanceResult){ %>
                                            <% if(balanceResult.timeSeries){ %>
                                                <% let annTotalAss %>
                                                    <%annTotalAss=balanceResult.timeSeries.annualTotalAssets%>

                                                        <% for(let i=0; i<annTotalAss.length; i++){ %>
                                                            <% let curr=annTotalAss[i] %>
                                                                <% if(curr){ %>
                                                                    <% if(curr.reportedValue){ %>
                                                                        <% if(totalAssets[i]){ %>
                                                                            <% totalAssets[i]=curr.reportedValue.fmt %>
                                                                                <% }}}} %>
                                                                                    <% }} %>
                                                                                        <div class="slide-data year1">
                                                                                            <%=totalAssets[2] %>
                                                                                        </div>
                                                                                        <div class="slide-data year2">
                                                                                            <%=totalAssets[1] %>
                                                                                        </div>
                                                                                        <div class="slide-data year3">
                                                                                            <%=totalAssets[0] %>
                                                                                        </div>
                                </div>
                                <div class="slide-data-wrapper total-liab">
                                    <div class="slide-data data-align-left">Total liabilities</div>
                                    <% let totalLiab={0:"--", 1:"--", 2:"--"} %>
                                        <% if(balanceResult){ %>
                                            <% if(balanceResult.timeSeries){ %>
                                                <% let annTotLiab %>
                                                    <% annTotLiab=balanceResult.timeSeries.annualTotalLiabilitiesNetMinorityInterest
                                                        %>
                                                        <% for(let i=0; i<annTotLiab.length; i++){ %>
                                                            <% let curr=annTotLiab[i] %>
                                                                <% if(curr){ %>
                                                                    <% if(totalLiab[i]){ %>
                                                                        <% totalLiab[i]=curr.reportedValue.fmt %>
                                                                            <% }}}}} %>
                                                                                <div class="slide-data year1">
                                                                                    <%=totalLiab[2] %>
                                                                                </div>
                                                                                <div class="slide-data year2">
                                                                                    <%=totalLiab[1] %>
                                                                                </div>
                                                                                <div class="slide-data year3">
                                                                                    <%=totalLiab[0] %>
                                                                                </div>
                                </div>
                                <div class="slide-data-wrapper total-equity">
                                    <div class="slide-data data-align-left">Total equity</div>
                                    <% let totalEquity={0:"--", 1:"--", 2:"--"} %>
                                        <% if(balanceResult){ %>
                                            <% if(balanceResult.timeSeries){ %>
                                                <% let annTotEq %>
                                                    <% annTotEq=balanceResult.timeSeries.annualStockholdersEquity %>
                                                        <% for(let i=0; i<annTotEq.length; i++){ %>
                                                            <% let curr=annTotEq[i] %>
                                                                <% if(curr && totalEquity[i]){ %>
                                                                    <% totalEquity[i]=curr.reportedValue.fmt %>
                                                                        <% }}}} %>
                                                                            <div class="slide-data year1">
                                                                                <%=totalEquity[2]%>
                                                                            </div>
                                                                            <div class="slide-data">
                                                                                <%=totalEquity[1] %>
                                                                            </div>
                                                                            <div class="slide-data">
                                                                                <%=totalEquity[0] %>
                                                                            </div>
                                </div>
                                <div class="slide-data-wrapper total-capitalization">
                                    <div class="slide-data data-align-left">Total capitalization</div>
                                    <% let totalCap={0:"--", 1:"--", 2:"--"} %>
                                        <% if(balanceResult){ %>
                                            <% if(balanceResult.timeSeries){ %>
                                                <% let annTotalCap %>
                                                    <% annTotalCap=balanceResult.timeSeries.annualCapitalStock %>
                                                        <% for(let i=0; i<annTotalCap.length; i++){ %>
                                                            <% let curr=annTotalCap[i] %>
                                                                <% if(curr && totalCap[i]){ %>
                                                                    <% totalCap[i]=curr.reportedValue.fmt %>
                                                                        <% }}}} %>
                                                                            <div class="slide-data year1">
                                                                                <%=totalCap[2] %>
                                                                            </div>
                                                                            <div class="slide-data year2">
                                                                                <%=totalCap[1] %>
                                                                            </div>
                                                                            <div class="slide-data year3">
                                                                                <%=totalCap[0] %>
                                                                            </div>
                                </div>
                                <div class="slide-data-wrapper long-term-debt">
                                    <div class="slide-data data-align-left">Long term debt</div>
                                    <% let longTermDebt={0:"--", 1:"--", 2:"--"} %>
                                        <% if(balanceResult){ %>
                                            <% if(balanceResult.timeSeries){ %>
                                                <% let annLngDebt %>
                                                    <% annLngDebt=balanceResult.timeSeries.annualLongTermDebt %>
                                                        <% for(let i=0; i<annLngDebt.length; i++){ %>
                                                            <% let curr=annLngDebt[i] %>
                                                                <% if(curr){ %>
                                                                    <% longTermDebt[i]=curr.reportedValue.fmt %>
                                                                        <% }}}} %>
                                                                            <div class="slide-data year1">
                                                                                <%=longTermDebt[2] %>
                                                                            </div>
                                                                            <div class="slide-data year2">
                                                                                <%=longTermDebt[1] %>
                                                                            </div>
                                                                            <div class="slide-data year3">
                                                                                <%=longTermDebt[0] %>
                                                                            </div>
                                </div>
                                <div class="slide-data-wrapper working-capital">
                                    <div class="slide-data data-align-left">Accounts receivable</div>
                                    <% let accRec={0:"--", 1:"--", 2:"--"} %>
                                        <% if(balanceResult){ %>
                                            <% if(balanceResult.timeSeries){ %>
                                                <% let annAccRec %>
                                                    <% annAccRec=balanceResult.timeSeries.annualAccountsReceivable%>
                                                        <% for(let i=0; i<annAccRec.length; i++){ %>
                                                            <% let curr=annAccRec[i] %>
                                                                <% if(curr){ %>
                                                                    <% accRec[i]=curr.reportedValue.fmt %>
                                                                        <% }}}} %>
                                                                            <div class="slide-data year1">
                                                                                <%=accRec[2] %>
                                                                            </div>
                                                                            <div class="slide-data year2">
                                                                                <%=accRec[1] %>
                                                                            </div>
                                                                            <div class="slide-data year3">
                                                                                <%=accRec[0] %>
                                                                            </div>
                                </div>
                                <div class="slide-data-wrapper total-debt">
                                    <div class="slide-data data-align-left">Accounts payable</div>
                                    <% let accPay={0:"--", 1:"--", 2:"--"} %>
                                        <% if(balanceResult){ %>
                                            <% if(balanceResult.timeSeries){ %>
                                                <% let annAccPay %>
                                                    <% annAccPay=balanceResult.timeSeries.annualAccountsPayable%>
                                                        <% for(let i=0; i<annAccPay.length; i++){ %>
                                                            <% let curr=annAccPay[i] %>
                                                                <% if(curr && accPay[i]){ %>
                                                                    <% accPay[i]=curr.reportedValue.fmt %>
                                                                        <% }}}} %>
                                                                            <div class="slide-data year1">
                                                                                <%=accPay[2] %>
                                                                            </div>
                                                                            <div class="slide-data year2">
                                                                                <%=accPay[1] %>
                                                                            </div>
                                                                            <div class="slide-data year3">
                                                                                <%=accPay[0] %>
                                                                            </div>
                                </div>

                                <div class="slide-data-wrapper shares-issued">
                                    <div class="slide-data data-align-left">Retained Earnings</div>
                                    <% let retEarn={0:"--", 1:"--", 2:"--"} %>
                                        <% if(balanceResult){ %>
                                            <% if(balanceResult.timeSeries){ %>
                                                <% let annRetEarn %>
                                                    <% annRetEarn=balanceResult.timeSeries.annualRetainedEarnings%>
                                                        <% for(let i=0; i<annRetEarn.length; i++){ %>
                                                            <% let curr=annRetEarn[i] %>
                                                                <% if(curr && retEarn[i]){ %>
                                                                    <% retEarn[i]=curr.reportedValue.fmt%>
                                                                        <% }}}} %>
                                                                            <div class="slide-data year1">
                                                                                <%=retEarn[2] %>
                                                                            </div>
                                                                            <div class="slide-data year2">
                                                                                <%=retEarn[1] %>
                                                                            </div>
                                                                            <div class="slide-data year3">
                                                                                <%=retEarn[0] %>
                                                                            </div>
                                </div>
                            </div>
                        </div>
                        <div id="cash-flow" class="slide">
                            <h6>Cash Flow</h6>
                            <div class="annual-label">Annual</div>
                            <div class="slide-boxes">
                                <div class="slide-data-wrapper slide-years cash-flow-slide-years">
                                    <div class="slide-data slide-headers data-align-left currency">(<%=ccy %>)</div>
                                    <div class="slide-data slide-headers ttm">TTM</div>
                                    <% let annualYear={"one":"--", "two" :"--"} %>
                                        <% if(cashFlowRes) {%>
                                            <% if(cashFlowRes.timestamp){ %>
                                                <% let cashTmestmpArr=cashFlowRes.timestamp %>
                                                    <% arrLastEle=cashTmestmpArr.length-1 %>
                                                        <% annualYear["one"]=cashTmestmpArr[arrLastEle] %>
                                                            <% annualYear["two"]=cashTmestmpArr[arrLastEle-1]%>
                                                                <% }} %>
                                                                    <div
                                                                        class="slide-data slide-headers year1 endingyr1">
                                                                        <%=annualYear["one"] %>
                                                                    </div>
                                                                    <div
                                                                        class="slide-data slide-headers year2 endingyr2">
                                                                        <%=annualYear["two"] %>
                                                                    </div>
                                </div>

                                <div class="slide-data-wrapper operating-cash-flow">
                                    <div class="slide-data data-align-left">Operating cash flow</div>
                                    <% let ttmOpCF="--" %>
                                        <% if(cashFlowRes){%>
                                            <% if(cashFlowRes.timeSeries){ %>
                                                <% if(cashFlowRes.timeSeries.trailingOperatingCashFlow){ %>
                                                    <% let cfOpArr=cashFlowRes.timeSeries.trailingOperatingCashFlow %>
                                                        <% if(cfOpArr.length> 0) {%>
                                                            <% arrLastEle=cfOpArr.length-1 %>
                                                                <% ttmOpCF=cfOpArr[arrLastEle].reportedValue.fmt %>
                                                                    <% }}}} %>
                                                                        <div class="slide-data ttm">
                                                                            <%=ttmOpCF %>
                                                                        </div>
                                                                        <div class="slide-data year1">

                                                                        </div>
                                                                        <div class="slide-data year2">

                                                                        </div>
                                </div>
                                <div class="slide-data-wrapper investing-cash-flow">
                                    <div class="slide-data data-align-left">Investing cash flow</div>
                                    <% let ttmInvCF="--" %>
                                        <% if(cashFlowRes){%>
                                            <% if(cashFlowRes.timeSeries){ %>
                                                <% if(cashFlowRes.timeSeries.trailingInvestingCashFlow){ %>
                                                    <% let cfIvArr=cashFlowRes.timeSeries.trailingInvestingCashFlow %>
                                                        <% if(cfIvArr.length> 0) {%>
                                                            <% arrLastEle=cfIvArr.length-1 %>
                                                                <% ttmOpCF=cfIvArr[arrLastEle].reportedValue.fmt %>
                                                                    <% }}}} %>
                                                                        <div class="slide-data ttm">
                                                                            <%=ttmInvCF %>
                                                                        </div>
                                                                        <div class="slide-data year1">

                                                                        </div>
                                                                        <div class="slide-data year2">

                                                                        </div>
                                </div>
                                <div class="slide-data-wrapper cash-dividends-paid">
                                    <% let tmDvPd="--" %>
                                        <% if(cashFlowRes){%>
                                            <% if(cashFlowRes.timeSeries){ %>
                                                <% if(cashFlowRes.timeSeries.trailingCashDividendsPaid){ %>
                                                    <% let cshDivAr%>
                                                        <% cshDivAr=cashFlowRes.timeSeries.trailingCashDividendsPaid %>
                                                            <% if(cshDivAr.length> 0) {%>
                                                                <% arrLastEle=cshDivAr.length-1 %>
                                                                    <% tmDvPd=cshDivAr[arrLastEle].reportedValue.fmt %>
                                                                        <% }}}} %>
                                                                            <div class="slide-data data-align-left">
                                                                                Cash dividends paid
                                                                            </div>
                                                                            <div class="slide-data ttm">
                                                                                <%= tmDvPd %>
                                                                            </div>
                                                                            <div class="slide-data year1">

                                                                            </div>
                                                                            <div class="slide-data year2">

                                                                            </div>
                                </div>
                                <div class="slide-data-wrapper end-cash-position">
                                    <% let ttmEdCshP="--" %>
                                        <% if(cashFlowRes){%>
                                            <% if(cashFlowRes.timeSeries){ %>
                                                <% if(cashFlowRes.timeSeries.trailingEndCashPosition){ %>
                                                    <% let edCsAr%>
                                                        <%edCsAr=cashFlowRes.timeSeries.trailingEndCashPosition %>
                                                            <% if(edCsAr.length> 0) {%>
                                                                <% arrLastEle=edCsAr.length-1 %>
                                                                    <% ttmEdCshP=edCsAr[arrLastEle].reportedValue.fmt %>
                                                                        <% }}}} %>

                                                                            <div class="slide-data data-align-left">
                                                                                End cash position</div>
                                                                            <div class="slide-data ttm">
                                                                                <%= ttmEdCshP %>
                                                                            </div>
                                                                            <div class="slide-data year1">

                                                                            </div>
                                                                            <div class="slide-data year2">

                                                                            </div>
                                </div>
                                <div class="slide-data-wrapper capital-expenditure">

                                    <% let ttmCapEx="--" %>

                                        <% if(cashFlowRes){%>
                                            <% if(cashFlowRes.timeSeries){ %>
                                                <% if(cashFlowRes.timeSeries.trailingCapitalExpenditure){ %>
                                                    <% let cpExAr%>
                                                        <%cpExAr=cashFlowRes.timeSeries.trailingCapitalExpenditure %>
                                                            <% if(cpExAr.length> 0) {%>
                                                                <% arrLastEle=cpExAr.length-1 %>
                                                                    <% ttmCapEx=cpExAr[arrLastEle].reportedValue.fmt %>
                                                                        <% }}}} %>
                                                                            <div class="slide-data data-align-left">
                                                                                Capital expenditure
                                                                            </div>
                                                                            <div class="slide-data ttm">
                                                                                <%=ttmCapEx %>
                                                                            </div>
                                                                            <div class="slide-data year1">

                                                                            </div>
                                                                            <div class="slide-data year2">

                                                                            </div>
                                </div>
                                <div class="slide-data-wrapper common-stock-iss">
                                    <% let ttmStkIs="--" %>
                                        <% if(cashFlowRes){%>
                                            <% if(cashFlowRes.timeSeries){ %>
                                                <% if(cashFlowRes.timeSeries.trailingCommonStockIssuance){ %>
                                                    <% let skIsA %>
                                                        <%skIsA=cashFlowRes.timeSeries.trailingCommonStockIssuance %>

                                                            <% if(skIsA.length> 0) {%>
                                                                <% arrLastEle=skIsA.length-1 %>
                                                                    <% ttmStkIs=skIsA[arrLastEle].reportedValue.fmt%>

                                                                        <% }}}} %>
                                                                            <div class="slide-data data-align-left">
                                                                                Common stock Issuance</div>
                                                                            <div class="slide-data ttm">
                                                                                <%=ttmStkIs %>
                                                                            </div>
                                                                            <div class="slide-data year1">

                                                                            </div>
                                                                            <div class="slide-data year2">

                                                                            </div>
                                </div>
                                <div class="slide-data-wrapper repayment-of-debt">
                                    <% let ttmRpDb="--" %>

                                        <% if(cashFlowRes){%>
                                            <% if(cashFlowRes.timeSeries){ %>
                                                <% if(cashFlowRes.timeSeries.trailingRepaymentOfDebt){ %>
                                                    <% let rpDbAr %>
                                                        <%rpDbAr=cashFlowRes.timeSeries.trailingRepaymentOfDebt %>

                                                            <% if(rpDbAr.length> 0) {%>
                                                                <% arrLastEle=rpDbAr.length-1 %>
                                                                    <% ttmRpDb=rpDbAr[arrLastEle].reportedValue.fmt %>
                                                                        <% }}}} %>
                                                                            <div class="slide-data data-align-left">
                                                                                Repayment of debt</div>
                                                                            <div class="slide-data ttm">
                                                                                <%= ttmRpDb %>
                                                                            </div>
                                                                            <div class="slide-data year1">

                                                                            </div>
                                                                            <div class="slide-data year2">

                                                                            </div>
                                </div>
                                <div class="slide-data-wrapper free-cash-flow">
                                    <% let ttmFCF="--" %>
                                        <% if(cashFlowRes){%>
                                            <% if(cashFlowRes.timeSeries){ %>
                                                <% if(cashFlowRes.timeSeries.trailingFreeCashFlow){ %>
                                                    <% let ttmFCFA%>
                                                        <% ttmFCFA=cashFlowRes.timeSeries.trailingFreeCashFlow %>

                                                            <% if(ttmFCFA.length> 0) {%>
                                                                <% arrLastEle=ttmFCFA.length-1 %>
                                                                    <% ttmFCF=ttmFCFA[arrLastEle].reportedValue.fmt %>
                                                                        <% }}}} %>
                                                                            <div class="slide-data data-align-left">
                                                                                Free cash flow</div>
                                                                            <div class="slide-data ttm">
                                                                                <%=ttmFCF %>
                                                                            </div>
                                                                            <div class="slide-data year1">

                                                                            </div>
                                                                            <div class="slide-data year2">

                                                                            </div>
                                </div>
                            </div>
                        </div>
            </div>
            </div>
        </section>
        <div id="summary_profile_container">
            <div id="summary_container">
                <h6>Summary</h6>
                <p id="company_desc">
                    <%let resultLB="" %>
                        <%if(getSumm.summaryProfile){ %>
                            <%resultLB=getSumm.summaryProfile.longBusinessSummary}%>
                                <%=resultLB%>
                </p>
            </div>
            <div id="profile_container">
                <% let h="" %>
                    <%if(getSumm.summaryProfile){ %>
                        <%if(getSumm.summaryProfile.address1){ %>
                            <% h="Profile" }}%>
                                <h6>
                                    <%=h %>
                                </h6>
                                <div id="profile_container2">
                                    <div id="address_container">
                                        <p id="address">
                                            <%let resultAd="" %>
                                                <%if(getSumm.summaryProfile){ %>
                                                    <%resultAd=getSumm.summaryProfile.address1}%>
                                                        <%=resultAd%>
                                        </p>
                                        <div id="city_state_container">
                                            <p id="city">
                                                <%let resultCi="" %>
                                                    <%if(getSumm.summaryProfile){ %>
                                                        <%resultCi=getSumm.summaryProfile.city}%>
                                                            <%=resultCi%>
                                            </p>
                                            <p id="state">
                                                <%let resultSt="" %>
                                                    <%if(getSumm.summaryProfile){ %>
                                                        <%resultSt=getSumm.summaryProfile.state}%>
                                                            <%=resultSt%>
                                            </p>
                                            <p id="zip">
                                                <%let resultZ="" %>
                                                    <%if(getSumm.summaryProfile){ %>
                                                        <%resultZ=getSumm.summaryProfile.zip}%>
                                                            <%=resultZ%>
                                            </p>
                                        </div>

                                        <p id="country">
                                            <%let resultCoun="" %>
                                                <%if(getSumm.summaryProfile){ %>
                                                    <%resultCoun=getSumm.summaryProfile.country}%>
                                                        <%=resultCoun%>
                                        </p>
                                        <p id="phone">
                                            <%let resultPh="" %>
                                                <%if(getSumm.summaryProfile){ %>
                                                    <%resultPh=getSumm.summaryProfile.phone}%>
                                                        <%=resultPh%>
                                        </p>
                                        <p id="website">
                                            <%let resultWeb="" %>
                                                <%if(getSumm.summaryProfile){ %>
                                                    <% if(getSumm.summaryProfile.website){ %>
                                                        <%resultWeb=getSumm.summaryProfile.website}}%>
                                                            <a href="<%=resultWeb%>" target="_blank">
                                                                <%=resultWeb%>
                                                            </a>


                                        </p>
                                        <p id="industry">
                                            <%let rInd="" %>
                                                <%if(getSumm.summaryProfile){ %>
                                                    <% if(getSumm.summaryProfile.industry){%>
                                                        <%rInd=getSumm.summaryProfile.industry%>
                                                            <% rInd=`Industry: ${rInd}` }}%>
                                                                <%=rInd %>
                                        </p>
                                        <p id="sector">
                                            <%let rSec="" %>
                                                <%if(getSumm.summaryProfile){ %>
                                                    <% if(getSumm.summaryProfile.sector){%>
                                                        <%rSec=getSumm.summaryProfile.sector%>
                                                            <% rSec=`Sector: ${rSec}`}} %>
                                                                <%=rSec%>
                                        </p>
                                    </div>
                                    <div id="employee_container">
                                        <p>
                                            <% let emH="" %>
                                                <% if(getSumm.summaryProfile){ %>
                                                    <% if(getSumm.summaryProfile.fullTimeEmployees){%>
                                                        <%emH="Full Time Employees:"%>
                                                            <% }} %>
                                                                <%=emH%>
                                        </p>
                                        <p>
                                            <% let em="" %>
                                                <% if(getSumm.summaryProfile){ %>
                                                    <% if(getSumm.summaryProfile.fullTimeEmployees){%>
                                                        <% em=getSumm.summaryProfile.fullTimeEmployees}} %>
                                                            <%= em %>
                                        </p>
                                    </div>
                                </div>

            </div>
        </div>
    </section>
    <footer id="ticker_footer">
        <%- include('./partials/footer.ejs') %>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script>
        const pageUrl = window.location.href;
        localStorage.setItem("url", pageUrl);
        const quoteSumm = `<%=getSumm%>`;
        const stockTicker = '<%=getSumm.symbol%>';
        const dividendRate = '<%=getSumm.summaryDetail.dividendRate.fmt%>'
        const exDivDate = '<%=getSumm.summaryDetail.exDividendDate.fmt%>'
        let yhooOpenPrice = '<%=getSumm.summaryDetail.open%>';
        const stockPriceChange = '<%=getSumm.price.regularMarketChange%>';
        const KEY = '<%=API_KEY%>';
        const HOST = '<%=RAPID%>';

        const regExp = /[a-zA-Z.^]/;
        const regExNums = /[0-9]/;

        const h2Box = document.querySelector("header>h2");
        const h2ChildNodes = h2Box.childNodes;
        const selection = window.getSelection();
        const pricePctContainers = document.querySelectorAll(".reg_hours_container");
        const regularPrice = document.getElementById("reg_hours_price");
        const regPointsPctContainer = document.querySelector("#reg_hours_pct_container");
        const afterHrsPrice = document.getElementById("after_hours_price");
        const afterHrsChange = document.getElementById("after_hours_change");
        const afterHrsPct = document.getElementById("after_hours_pct");
        const afterHoursContainer = document.querySelector("#after_container");
        const atCloseContainer = document.querySelector("#at_close_container");
        const afterHoursTimeContainer = document.querySelector("#after_hours_time_container");

        const pricesAndPercents = document.querySelectorAll(".price");

        const summaryProfileContainer = document.querySelector("#summary_profile_container");
        const companyDesc = document.querySelector("#company_desc");
        const ratioContainer = document.querySelector("#ratio-container");
        const prevCloseContainer = document.querySelector("#prev-close-container");
        const indexData = document.querySelectorAll("#index_data_container > div > .border-line > .indexData");

        const chartTimelineContainer = document.querySelector("#chart-timeline-container");
        const canvas = document.querySelector("#chart");
        let chart, timeoutId, currMktState, timeout = undefined, timeout2 = undefined, red = "#b11e31", green = "#148a61";

        // Function to update the progress bar
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBar = document.getElementById('progress-bar');

        const slidesWrapper = document.querySelector('.slides-wrapper');
        const slides = Array.from(document.querySelectorAll(".slide"));
        const slideNavChevrons = Array.from(document.querySelectorAll(".chevrons"));

        //starting variables;
        let isDragging = false, startPosition = 0, currTranslateX = 0, prevTranslateX = 0, animationId = 0, currSlideIndex = 0;
        slides.forEach((slide, index) => {
            //touch events
            slide.addEventListener('touchstart', touchStart(index))
            slide.addEventListener('touchend', touchEnd);
            slide.addEventListener('touchmove', touchMove)
            //mouse events
            slide.addEventListener('mousedown', touchStart(index))
            slide.addEventListener('mouseup', touchEnd)
            slide.addEventListener('mouseleave', touchEnd)
            slide.addEventListener('mousemove', touchMove)
        })

        slideNavChevrons.forEach((chevron) => {
            chevron.addEventListener("click", () => {
                //next button
                let chevronDirection = chevron.classList.contains("slide-next");
                isDragging = true;
                animationId = requestAnimationFrame(animation);
                if (chevronDirection) {
                    if (currSlideIndex < slides.length - 1) {
                        currSlideIndex += 1
                    }
                }

                //prev button
                if (!chevronDirection) {
                    if (currSlideIndex > 0) {
                        currSlideIndex -= 1;
                    }
                }


                isDragging = false;
                cancelAnimationFrame(animationId);
                setPostionByIndex()
            })
        })

        function touchStart(index) {
            return function (event) {
                currSlideIndex = index;
                startPosition = getPositionX(event);

                isDragging = true;
                animationId = requestAnimationFrame(animation);
                slidesWrapper.style.cursor = "grabbing";
            }
        }

        function touchEnd() {
            isDragging = false;
            cancelAnimationFrame(animationId);
            const movedBy = currTranslateX - prevTranslateX;

            if (movedBy < -50 && currSlideIndex < slides.length - 1) {
                currSlideIndex += 1

            }
            if (movedBy > 50 && currSlideIndex > 0) currSlideIndex -= 1;
            setPostionByIndex()
            slidesWrapper.style.cursor = "grab";
        }

        function touchMove(event) {
            if (isDragging) {
                const currentPosition = getPositionX(event)
                currTranslateX = prevTranslateX + currentPosition - startPosition;

            }
        }

        function getPositionX(event) {
            return event.type.includes("mouse") ? event.pageX : event.touches[0].clientX;
        }

        function animation() {
            setSliderPosition()
            if (isDragging) requestAnimationFrame(animation)
        }

        function setSliderPosition() {
            slidesWrapper.style.transform = `translateX(${currTranslateX}%)`;
        }

        function setPostionByIndex() {
            currTranslateX = currSlideIndex * -105;
            prevTranslateX = currTranslateX;
            setSliderPosition()
        }

        const setMarketTime = (timeStamp) => {
            let date, formatted;

            date = new Date(timeStamp * 1000);
            formatted = new Intl.DateTimeFormat('en-US', {
                dateStyle: 'short',
                timeStyle: 'long',
                timeZone: 'America/New_York',
            }).format(date)

            return formatted

        }

        const changePctPointsColor = (prevClosePrice) => {
            let green = "#096344", red = "#c4283c";

            let currentPrice = regularPrice.innerText;
            currentPrice = parseFloat(currentPrice);

            let afterPrice = afterHrsPrice.innerText;

            regularPrice.style.color = green;
            regPointsPctContainer.children[0].style.color = green;
            regPointsPctContainer.children[1].style.color = green;

            if (currentPrice < prevClosePrice) {
                regularPrice.style.color = red;
                regPointsPctContainer.children[0].style.color = red;
                regPointsPctContainer.children[1].style.color = red;
            }

            if (afterPrice) {
                afterHrsPrice.style.color = green;
                afterHrsChange.style.color = green;
                afterHrsPct.style.color = green;

                afterPrice = parseFloat(afterPrice);
                if (afterPrice < currentPrice) {
                    afterHrsPrice.style.color = red;
                    afterHrsChange.style.color = red;
                    afterHrsPct.style.color = red;
                }
            }

        };
        const formatPrice = (container) => {

            for (let ele of container) {
                let formatted;
                let formatNum = ele.innerText;

                //check for ex-dividend element;
                const exDivCheck = ele.classList.contains("exDivDate");
                const divRate = ele.classList.contains("div-rate");
                const commaClass = ele.classList.contains("commas");
                if (formatNum !== "N/A" && !exDivCheck && !divRate) {

                    formatted = new Intl.NumberFormat("en-US", {
                        style: "decimal",
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                    }).format(formatNum);

                }

                if (divRate) {
                    formatted = "N/A";
                    if (dividendRate) {
                        formatNum = dividendRate;
                        formatted = new Intl.NumberFormat("en-US", {
                            style: "decimal",
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2,
                        }).format(formatNum);
                    }
                }

                if (exDivCheck) {
                    formatted = "N/A";
                    if (dividendRate) {
                        formatNum = dividendRate;
                        formatted = new Intl.NumberFormat("en-US", {
                            style: "decimal",
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2,
                        }).format(formatNum);
                    }
                    if (exDivDate) {
                        let date = new Date(exDivDate);
                        formatted = new Intl.DateTimeFormat("en-US", { dateStyle: "medium", timeZone: "UTC" }).format(date);
                    }
                }

                if (commaClass && formatNum !== "N/A") {
                    let regExpComma = /,/g;
                    //how many commas are there?
                    let commas = formatted.match(regExpComma);

                    //get the index of the first comma;
                    let commaIndex = formatted.search(regExpComma);
                    //turn the comma into a decimal if needed;
                    // let firstCommaChar = formatted.charAt(commaIndex);

                    //get index of next comma;
                    //make it the endIndex;

                    let str;
                    let startIndex = 0;

                    if (commas.length === 4) {
                        str = formatted.slice(startIndex, commaIndex);
                        formatted = `${str}T`
                    }

                    if (commas.length === 3) {
                        str = formatted.slice(startIndex, commaIndex);
                        formatted = `${str}B`
                    }

                    if (commas.length === 2) {
                        str = formatted.slice(startIndex, commaIndex);
                        formatted = `${str}M`
                    }

                }

                if (!formatted) formatted = "N/A";
                ele.innerText = formatted;
            }
            return
        };

        const setSession = (res) => {
            const sessionObj = res.chart.result[0];

            //current market session period;
            const currTradingPeriod = sessionObj.meta.currentTradingPeriod;
            const preTime = currTradingPeriod.pre;
            const regTime = currTradingPeriod.regular;
            const postTime = currTradingPeriod.post;

            //previous closing price;
            let previousClose = sessionObj.meta.previousClose;
            previousClose = parseFloat(previousClose);

            //pre/reg/post prices cache;
            let prices = {
                pre: "",
                reg: "",
                post: ""
            };

            const timeStampsArr = sessionObj.timestamp;
            const quotesArr = sessionObj.indicators.quote[0];
            const openPriceArr = quotesArr.open;
            const closePriceArr = quotesArr.close;

            //update prices object:
            for (let i = 0; i <= timeStampsArr.length; i++) {
                let currTimeStamp = timeStampsArr[i];

                if (currTimeStamp < preTime.end) {
                    prices["pre"] = closePriceArr[i];
                }

                if (currTimeStamp === preTime.end) {
                    prices["pre"] = openPriceArr[i];
                }

                if (currTimeStamp > regTime.start && currTimeStamp < regTime.end) {
                    prices["reg"] = closePriceArr[i];
                }

                if (currTimeStamp === regTime.end) {
                    prices["reg"] = closePriceArr[i];
                }

                if (currTimeStamp > postTime.start) {
                    console.log("post")

                    prices["post"] = closePriceArr[i];
                }
            }
            console.log("prices obj:", prices)
            //pre/post mkt price;
            let preMktPrice = parseFloat(prices["pre"]).toFixed(2), postMktPrice = parseFloat(prices["post"]).toFixed(2), regMktPrice = parseFloat(prices["reg"]).toFixed(2), regDateTime, currPrice, afterHoursPrice;
            let afterHoursPointsChng, afterHoursPctChng, regPointsChg, regPctChng, marketState;
            //Set session in HTML;
            //what time is it?
            const currTimeInSeconds = Date.now() / 1000;
            //set html elements with respective price values;
            //pre-Mkt:
            if (currTimeInSeconds < preTime.end) {
                regDateTime = "Last Closed:";
                currPrice = previousClose;
                afterHoursPrice = preMktPrice;
                marketState = "Pre-Market:"
            }

            if (currTimeInSeconds >= regTime.start && currTimeInSeconds < regTime.end) {
                regDateTime = "Current Session:";
                currPrice = regMktPrice;
            }

            if (currTimeInSeconds >= postTime.start) {
                regDateTime = "Last Closed:";
                currPrice = regMktPrice;
                afterHoursPrice = postMktPrice;
                marketState = "After Hours:"
            }

            //update reg-mkt points and percentage changes;
            regPointsChg = currPrice - previousClose;
            regPointsChg = regPointsChg.toFixed(2);

            regPctChng = (regPointsChg / previousClose) * 100;
            regPctChng = regPctChng.toFixed(2);

            regularPrice.innerText = currPrice;
            regPointsPctContainer.children[0].innerText = regPointsChg;
            regPointsPctContainer.children[1].innerText = regPctChng;

            atCloseContainer.children[0].innerText = regDateTime;
            atCloseContainer.children[1].innerText = setMarketTime(currTimeInSeconds);
            if (currTimeInSeconds >= regTime.end) {
                atCloseContainer.children[1].innerText = setMarketTime(regTime.end);
            }

            if (currTimeInSeconds < preTime.start) {
                let prevCloseDate = regTime.end - 86400;
                atCloseContainer.children[1].innerText = setMarketTime(prevCloseDate);
            }

            //****Pre/Post Mkt:
            //html
            afterHoursPointsChng = afterHoursPrice - currPrice;
            afterHoursPctChng = (afterHoursPointsChng / currPrice) * 100;

            afterHrsPrice.innerText = afterHoursPrice;
            afterHrsChange.innerText = afterHoursPointsChng.toFixed(2);
            afterHrsPct.innerText = afterHoursPctChng.toFixed(2);

            //set after-hours time container;
            if (regDateTime === "Current Session") {
                afterHoursContainer.style.display = "none";
            } else {
                afterHoursTimeContainer.children[0].innerText = marketState;
                afterHoursTimeContainer.children[1].innerText = setMarketTime(currTimeInSeconds);
            }

            if (companyDesc.innerText === "") {
                summaryProfileContainer.style.display = "none";
                ratioContainer.style.display = "none";
                prevCloseContainer.style.maxWidth = "100%";
            }

            changePctPointsColor(previousClose);

        }

        const grabChartData = async (symbol, range) => {
            let url;
            switch (range) {
                case "1d":
                    url = `https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v2/get-chart?interval=5m&region=US&symbol=${symbol}&range=1d`
                //url = `https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v3/get-chart?interval=5m&symbol=${symbol}&range=1d&region=US&includePrePost=false&useYfid=true&includeAdjustedClose=true`
                case "5d":
                    url = `https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v2/get-chart?interval=60m&region=US&symbol=${symbol}&range=5d`
                    //`https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v3/get-chart?interval=60m&region=US&symbol=${symbol}&range=5d&includePrePost=false&useYfid=true&includeAdjustedClose=true`;
                    break;
                case "1mo":
                    url = `https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v2/get-chart?interval=1d&region=US&symbol=${symbol}&range=1mo`
                    //`https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v3/get-chart?interval=1d&region=US&symbol=${symbol}&range=1mo&includePrePost=false&useYfid=true&includeAdjustedClose=true`;
                    break;
                case "YTD":
                    url = `https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v2/get-chart?interval=1d&region=US&symbol=${symbol}&range=ytd`
                    //`https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v3/get-chart?interval=1wk&region=US&symbol=${symbol}&range=ytd&includePrePost=false&useYfid=true&includeAdjustedClose=true`;
                    break;
                case "2y":
                    url = `https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v2/get-chart?interval=1d&region=US&symbol=${symbol}&range=2y`
                    //`https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v3/get-chart?interval=1mo&region=US&symbol=${symbol}&range=2y&includePrePost=false&useYfid=true&includeAdjustedClose=true`;
                    break;
                default:
                    console.log("Range not found");
            }

            const apiOptions = {
                method: "GET",
                headers: {
                    "X-RapidAPI-Key": KEY,
                    "X-RapidAPI-Host": HOST,
                },
            };

            let response = await fetch(url, apiOptions)
                .then((resp) => resp.json())
                .catch((e) => console.log(e));

            return response;
        };

        const fillChartData = async (responseData, range) => {
            let chartResp, chartTimes, closeQuote, openQuote;

            console.log("responseData:", responseData)

            let chartData = {
                datasets: [
                    {
                        label: "",
                        data: [],
                        borderColor: "",
                        backgroundColor: "",
                        tension: 0.1,
                        pointRadius: 0,
                    },
                ],
                labels: [],
            };


            chartResp = responseData.chart.result[0];
            chartTimes = responseData.chart.result[0].timestamp;
            openQuote = responseData.chart.result[0].indicators.quote[0].open;
            closeQuote = responseData.chart.result[0].indicators.quote[0].close;
            //Iterate over timestamp array, start from the last one, go backwards;
            let timestampEnd = chartTimes.length - 1;

            //return chartdata object;
            //start from the last one and go backwards;
            let firstChartPrice, finalChartPrice, nextTimestamp, currTimestamp, date, formatted;
            for (let i = timestampEnd; i >= 0; i--) {
                currTimestamp = chartTimes[i];

                date = new Date(currTimestamp * 1000);

                formatted = new Intl.DateTimeFormat("en-US", {
                    dateStyle: "short",
                    timeStyle: "long",
                    timeZone: "America/New_York",
                }).format(date);

                let labelDate = formatted;
                let mktPrice = closeQuote[i]; //closing price;

                //get next element date info;
                let nextDateCreate, nextDate, nextFormattedTime;
                if (chartTimes[i - 1] !== undefined) {
                    nextTimestamp = chartTimes[i - 1];
                    nextTimestamp *= 1000;
                    nextDateCreate = new Date(nextTimestamp);
                    nextDate = nextDateCreate.getDate();
                }

                //curr timestamp
                let currHours = date.getHours();
                let currMin = date.getMinutes();
                let currDate = date.getDate();
                //curr mkt open timestamp;
                let marketOpen = chartResp.meta.currentTradingPeriod.regular.start;
                let mktOpenDate = new Date(marketOpen * 1000);

                //mkt open;
                let mktHourOpen = mktOpenDate.getHours();
                let mktMinsOpen = mktOpenDate.getMinutes();

                //check if curr timestamp is market open;
                if (mktHourOpen === currHours && mktMinsOpen === currMin) {
                    mktPrice = openQuote[i];
                }

                chartData.datasets[0].data.unshift(mktPrice);
                chartData.labels.unshift(labelDate);

                //set color of line chart here;
                //chartData.datasets[0].border, background, color;

                let latestPrice = chartData.datasets[0].data.length - 1;
                latestPrice = chartData.datasets[0].data[latestPrice];
                let earliestPrice = chartData.datasets[0].data[0];

                if (latestPrice >= earliestPrice) {
                    chartData.datasets[0].backgroundColor = green;
                    chartData.datasets[0].borderColor = green;
                } else {
                    chartData.datasets[0].backgroundColor = red;
                    chartData.datasets[0].borderColor = red;
                }

                if (range === "1d") {
                    if (currDate !== nextDate) {
                        return chartData
                    }
                }

            }
            return chartData;
        };

        const runChart = async (range) => {
            console.log("range:", range)
            progressBarContainer.style.display = "initial"
            let stockChart = document.querySelector("#chart");
            stockChart.style.display = "none";

            let grabchart, fillchart, response;

            response = await grabChartData(stockTicker, range).then((res) => { return res }).catch((e) => console.log(e));
            //set session
            if (range === "1d") {
                setSession(response);
            }

            fillchart = await fillChartData(response, range).then((res) => { return res }).catch((e) => console.log(e));

            progressBarContainer.style.display = "none"
            stockChart.style.display = "initial";

            let chartResult = fillchart, options;
            console.log("chartResult:", chartResult)
            options = {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: {
                            display: true,
                            color: "black"
                        }
                    },
                    x: {
                        display: true,
                        grid: {
                            display: false
                        },
                        ticks: {
                            major: {
                                enabled: true
                            },
                            callback: (index) => {
                                let label = chartResult.labels[index], labelStr, str1, str2, regExprColon = /[:]/, regExpComma = /[,]/, startIndex = 0, endIndex;
                                let colonIndex = label.search(regExprColon), commaIndex = label.search(regExpComma);
                                console.log(label)
                                if (range === "1d") {
                                    startIndex = commaIndex + 2;
                                    endIndex = colonIndex + 3;
                                    str2 = label.slice(-6);
                                } else {
                                    startIndex = 0;
                                    endIndex = commaIndex;
                                    str2 = ""
                                }

                                str1 = label.slice(startIndex, endIndex);

                                labelStr = `${str1} ${str2}`;

                                return labelStr
                            }
                        },
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    labels: {
                        font: {
                            size: 9
                        }
                    }
                },
                animations: {
                    radius: {
                        duration: 600,
                        easing: 'linear',
                        loop: true,
                        radius: 1,
                    }
                },

                interaction: {
                    mode: 'nearest',
                    intersect: false,
                    axis: 'x'
                }
            }

            const config = {
                type: "line",
                data: chartResult,
                options: options
            }

            chart = new Chart(canvas, config);

            return chart
        }

        const runProgressBar = (range) => {
            if (timeoutId) {
                clearTimeout(timeoutId);
            }
            progressBar.setAttribute("class", "run-progress-animation")
            timeoutId = setTimeout(() => {
                runChart(range);
            }, 0)
        }

        const idlePage = () => {
            if (timeout) {
                clearInterval(timeout);
            }
            timeout = setInterval(() => {
                location.reload();
            }, 60000);
        }
        const activePage = () => {
            if (timeout2) clearInterval(timeout2);
            timeout2 = setTimeout(async () => {
                await getRapidPrices(apiKey, stockTicker);
                formatPrice(pricesAndPercents);
                changePctPointsColor(pricePctContainers);
                console.log("active");
            }, 180000);
        }

        const setEventListeners = () => {
            //timeline links: 1d 5d ytd 1y 2yr
            let timelineLinks = chartTimelineContainer.children;

            timelineLinks[0].addEventListener("click", () => {
                chart.destroy();
                runProgressBar("1d");
            });

            timelineLinks[1].addEventListener("click", () => {
                chart.destroy();
                runProgressBar("5d");
            });

            timelineLinks[2].addEventListener("click", () => {
                chart.destroy();
                runProgressBar("1mo");
            });

            timelineLinks[3].addEventListener("click", () => {
                chart.destroy();
                runProgressBar("YTD");
            });

            timelineLinks[4].addEventListener("click", () => {
                chart.destroy();
                runProgressBar("2y");
            });

            // document.addEventListener("click", idlePage);
            // document.addEventListener("keypress", idlePage);
            // document.addEventListener("mousemove", idlePage);
            // document.addEventListener("scroll", idlePage);

            h2Box.addEventListener("focus", () => {
                const h2ChildNodes = h2Box.childNodes;
                const selection = window.getSelection();
                if (h2Box.innerText === "Enter ticker...") {
                    h2Box.innerText = "";
                }
                //set caret position after text node
                if (h2ChildNodes.length > 0) {
                    selection.setPosition(h2ChildNodes[0], h2ChildNodes[0].length);
                } else {
                    selection.setPosition(h2Box, 0);
                }

                return;
            });
            h2Box.addEventListener("focusout", () => {
                if (h2Box.innerText === "") h2Box.innerText = "Enter ticker...";
                if (h2Box.style.backgroundColor === "#15192f") {
                    h2Box.style.backgroundColor === "#012c12";
                }
            });
            h2Box.addEventListener("keydown", (e) => {
                const textString = h2Box.innerText;
                if (textString.length >= 5 && e.key !== "Backspace" && e.key !== "Enter") {
                    e.preventDefault();
                    alert("Character amount exceeded");
                }
                //prevent navigation keys;
                if (textString.length > 0) {
                    let navKeys = [
                        "ArrowLeft",
                        "ArrowRight",
                        "ArrowDown",
                        "ArrowUp",
                        "Left",
                        "Right",
                        "Up",
                        "Down",
                        "Home",
                        "End",
                        "Del",
                        "Delete",
                        "PageUp",
                        "PageDown",
                        "Insert",
                    ];

                    for (const ele of navKeys) {
                        if (e.key === ele) {
                            e.preventDefault();
                            alert("Invalid entry");
                        }
                    }

                    if (textString === "" && e.key === "Enter") {
                        e.preventDefault();
                        alert("enter a valid ticker");
                    }

                    if (e.key === "Enter" && textString !== "") {
                        //enter the ticker string into the url parameter
                        //grab the URL;
                        //grab url param instead of string of element;
                        //window.location.href
                        let url = '<%=CURR_DOMAIN%>'
                        //'http://localhost:3000/'
                        url = `${url}${textString}`
                        console.log(url);
                        //check ticker string
                        window.location.href = url;
                    }
                }
                //prevent non-letters
                //Allow Backspace, Enter keys;
                //Note: navigation keys are failing the regexp test;
                if (regExp.test(e.key) === false) {
                    if (e.key !== "Backspace" && e.key !== "Enter") {
                        e.preventDefault();
                        alert("Invalid entry");
                    }
                }
            });
        }

        h2Box.focus();
        ratioContainer.removeAttribute("style");
        afterHoursContainer.removeAttribute("style");
        summaryProfileContainer.removeAttribute("style");
        runProgressBar("1d");
        changePctPointsColor(pricePctContainers, stockPriceChange);

        setEventListeners();
    </script>

</body>

</html>